pipeline {
    agent any
    stages {
        stage("Check Branch Name") {
            steps {
                script {
                    def branchName = env.BRANCH_NAME
                    if (!branchName) {
                        echo "Error: No branch name found."
                        currentBuild.result = 'ABORTED'
                    } else if (branchName == "main" || branchName.startsWith("feature/") || branchName.startsWith("bugfix/")) {
                        echo "Warning: The branch name '${branchName}' seems inappropriate."
                    }
                }
            }
        }
        stage("Test") {
            when {
                branchExists()
            }
            steps {
                echo "Test stage."
            }
        }
        stage("Fail") {
            when {
                allOf {
                    branchExists()
                    anyOf {
                        branch "main"
                        branch "feature/*"
                        branch "bugfix/*"
                    }
                }
            }
            steps {
                error("Wrong name for: ${env.BRANCH_NAME}")
            }
        }
    }
}
